angular.module("myApp",["ngRoute"]),(()=>{function o(e,r,c,a){var i=!1,l=[];return{request:function(o){var e;return o.url.endsWith(".html")||(e=r.localStorage.getItem("accessToken"))&&(o.headers.Authorization="Bearer ".concat(e)),o},responseError:function(t){var n,o;return 401!==t.status||i?401===t.status&&i?(o=e.defer(),l.push(o),o.promise.then(function(){var o=a.get("$http"),e=r.localStorage.getItem("accessToken");return t.config.headers.Authorization="Bearer ".concat(e),o(t.config)})):e.reject(t):(i=!0,n=a.get("$http"),(o=r.localStorage.getItem("refreshToken"))?n.post("http://localhost:5007/api/Login/RefreshToken",{refreshToken:o}).then(function(o){var o=o.data.accessToken,e=(r.localStorage.setItem("accessToken",o),i=!1,l.forEach(function(o){return o.resolve()}),l=[],t.config);return e.headers.Authorization="Bearer ".concat(o),n(e)}).catch(function(o){return i=!1,u(a,c),e.reject(o)}):(u(a,c),e.reject(t)))}};function u(o,e){o.get("authService").logout(),e.path("/login")}}angular.module("myApp").factory("authInterceptor",o),o.$inject=["$q","$window","$location","$injector"]})(),(()=>{function o(e,t){e.books=[],t.getBooks().then(function(o){e.books=o}),e.deleteBook=function(o){confirm("Do you Want to delete?")&&t.deleteBook(o).then(function(o){e.books=o})}}angular.module("myApp").controller("AdminBookController",o),o.$inject=["$scope","bookService"]})(),(()=>{function o(o,e,t){var n=this;n.book={title:"",author:"",price:"",stock:"",categoryId:""},n.error="",n.category=[],o.get("http://localhost:5007/api/Categorys/GetAllCategory").then(function(o){n.category=o.data}),n.AddBook=function(){n.addBookForm&&n.addBookForm.$invalid?angular.forEach(n.addBookForm,function(o,e){"$"!==e[0]&&o.$setTouched&&o.$setTouched()}):e.addBook(n.book).then(function(){t.path("/")}).catch(function(o){return console.log(o)})}}angular.module("myApp").controller("BookAddController",o),o.$inject=["$http","bookService","$location"]})(),(()=>{function o(){}angular.module("myApp").controller("HomeController",o),o.$inject=[]})(),(()=>{function o(e,o){var t=this;t.user={userName:"",password:""},t.error="",t.login=function(){t.loginForm&&t.loginForm.$invalid?angular.forEach(t.loginForm,function(o,e){"$"!==e[0]&&o.$setTouched&&o.$setTouched()}):o.login(t.user).then(function(o){e.path("/"),t.error=""}).catch(function(o){console.error(o),t.error=o})}}angular.module("myApp").controller("LoginController",o),o.$inject=["$location","authService"]})(),(()=>{function o(e,o){e.books=[],o.getBooks().then(function(o){e.books=o})}angular.module("myApp").controller("UserBookController",o),o.$inject=["$scope","bookService"]})(),angular.module("myApp").config(["$routeProvider","$httpProvider",function(o,e){o.when("/",{templateUrl:"app/view/home.html",controller:"HomeController",controllerAs:"vm"}).when("/login",{templateUrl:"app/view/login.html",controller:"LoginController",controllerAs:"vm"}).when("/adminbook",{templateUrl:"app/view/adminBookPage.html",controller:"AdminBookController",controllerAs:"vm",resolve:{auth:["$q","$location","authService","tokenService",function(o,e,t,n){return t.isAuthenticated()?"SPAdmin"===(n=(t=n.decode())?t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]:null)||"Admin"===n||(e.path("/unauthorized"),o.reject("Not authorized")):(e.path("/login"),o.reject("Not authenticated"))}]}}).when("/addbook",{templateUrl:"app/view/bookAdd.html",controller:"BookAddController",controllerAs:"vm",resolve:{auth:["$q","$location","authService","tokenService",function(o,e,t,n){return t.isAuthenticated()?"SPAdmin"===(n=(t=n.decode())?t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]:null)||"Admin"===n||(e.path("/unauthorized"),o.reject("Not authorized")):(e.path("/login"),o.reject("Not authenticated"))}]}}).when("/userbook",{templateUrl:"app/view/userBookPage.html",controller:"UserBookController",controllerAs:"vm",resolve:{auth:["$q","$location","authService","tokenService",function(o,e,t,n){return t.isAuthenticated()?"User"===((t=n.decode())?t["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]:null)||(e.path("/unauthorized"),o.reject("Not authorized")):(e.path("/login"),o.reject("Not authenticated"))}]}}).when("/unauthorized",{templateUrl:"app/view/unauthorized.html"}).otherwise({redirectTo:"/"}),e.interceptors.push("authInterceptor")}]),angular.module("myApp").service("authService",["$http","$window","$rootScope",function(e,t,n){this.login=function(o){return e.post("".concat("http://localhost:5007/api/","Login/LoginUser"),o).then(function(o){return o.data&&(t.localStorage.setItem("accessToken",o.data.accessToken),t.localStorage.setItem("refreshToken",o.data.refreshToken),n.$emit("loginSuccess")),o.data}).catch(function(o){throw o.data.message})},this.getToken=function(){return t.localStorage.getItem("accessToken")},this.isAuthenticated=function(){return!!this.getToken()},this.logout=function(){t.localStorage.removeItem("accessToken"),t.localStorage.removeItem("refreshToken"),n.$emit("logoutSuccess")}}]),(()=>{function o(t){var n={books:[]},r=(this.state=n,"http://localhost:5007/api/");this.getBooks=function(){return t.get("".concat(r,"Books/GellAllBooks")).then(function(o){return n.books=o.data,n.books}).catch(function(o){throw console.error("Error fetching books:",o),o})},this.deleteBook=function(e){return t.delete("".concat(r,"Books/DeleteBook/").concat(e)).then(function(){return n.books=n.books.filter(function(o){return o.bookId!==e}),n.books}).catch(function(o){throw console.error("Error deleting book:",o),o})},this.addBook=function(o){return t.post("".concat(r,"Books/AddBook"),o).then(function(){return n.books.push(o),n.books}).catch(function(o){throw console.error("Error at Adding",o),o})}}angular.module("myApp").service("bookService",o),o.$inject=["$http"]})(),(()=>{function o(e){return{decode:function(){var o=e.localStorage.getItem("accessToken");if(!o)return null;try{return jwt_decode(o)}catch(o){return console.error("Invalid token:",o),null}}}}angular.module("myApp").factory("tokenService",o),o.$inject=["$window"]})(),(()=>{function o(o){this.title="Book Management System",this.subtitle="Easily manage your books, add new titles, track availability, and keep everything organized.",this.ctaText="Get Started",this.goToAddBook=function(){o.path("/addbook")}}angular.module("myApp").component("heroSection",{templateUrl:"app/component/heroSection/hero.html",controller:o,controllerAs:"hero"}),o.$inject=["$location"]})(),(()=>{function o(){}angular.module("myApp").component("appFooter",{templateUrl:"app/layouts/footer/footer.html",controller:o}),o.$inject=[]})(),(()=>{function o(o,e,t,n){var r=this;function c(){var o=t.decode();r.role=o?o["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]:null}r.isLoggedIn=function(){return o.isAuthenticated()},n.$on("loginSuccess",function(){c()}),n.$on("logoutSuccess",function(){r.role=null}),r.hasAdminAccess=function(){return r.isLoggedIn()&&("SPAdmin"===r.role||"Admin"===r.role)},r.hasUserAccess=function(){return r.isLoggedIn()&&"User"===r.role},r.logout=function(){o.logout(),e.path("/login")},c()}angular.module("myApp").controller("NavbarController",o),o.$inject=["authService","$location","tokenService","$rootScope"]})();