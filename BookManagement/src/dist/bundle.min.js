angular.module("myApp",["ngRoute"]),(()=>{function o(t,r,c,a){var i=!1,l=[];return{request:function(o){var t;return o.url.endsWith(".html")||(t=r.localStorage.getItem("accessToken"))&&(o.headers.Authorization="Bearer ".concat(t)),o},responseError:function(e){var n,o;return 401!==e.status||i?401===e.status&&i?(o=t.defer(),l.push(o),o.promise.then(function(){var o=a.get("$http"),t=r.localStorage.getItem("accessToken");return e.config.headers.Authorization="Bearer ".concat(t),o(e.config)})):t.reject(e):(i=!0,n=a.get("$http"),(o=r.localStorage.getItem("refreshToken"))?n.post("http://localhost:5007/api/Login/RefreshToken",{refreshToken:o}).then(function(o){var o=o.data.accessToken,t=(r.localStorage.setItem("accessToken",o),i=!1,l.forEach(function(o){return o.resolve()}),l=[],e.config);return t.headers.Authorization="Bearer ".concat(o),n(t)}).catch(function(o){return i=!1,u(a,c),t.reject(o)}):(u(a,c),t.reject(e)))}};function u(o,t){o.get("authService").logout(),t.path("/login")}}angular.module("myApp").factory("authInterceptor",o),o.$inject=["$q","$window","$location","$injector"]})(),(()=>{function o(o,t,e){var n=this;n.book={title:"",author:"",price:"",stock:"",categoryId:""},n.error="",n.category=[],o.get("http://localhost:5007/api/Categorys/GetAllCategory").then(function(o){n.category=o.data}),n.AddBook=function(){n.addBookForm&&n.addBookForm.$invalid?angular.forEach(n.addBookForm,function(o,t){"$"!==t[0]&&o.$setTouched&&o.$setTouched()}):t.addBook(n.book).then(function(){e.path("/")}).catch(function(o){return console.log(o)})}}angular.module("myApp").controller("BookAddController",o),o.$inject=["$http","bookService","$location"]})(),(()=>{function o(o,t,e,n){e.books=[],n.getBooks().then(function(o){e.books=o}),e.deleteBook=function(o){confirm("Do you Want to delete?")&&n.deleteBook(o).then(function(o){e.books=o})},e.isLoggedIn=function(){return o.isAuthenticated()}}angular.module("myApp").controller("HomeController",o),o.$inject=["authService","$rootScope","$scope","bookService"]})(),(()=>{function o(t,o){var e=this;e.user={userName:"",password:""},e.error="",e.login=function(){e.loginForm&&e.loginForm.$invalid?angular.forEach(e.loginForm,function(o,t){"$"!==t[0]&&o.$setTouched&&o.$setTouched()}):o.login(e.user).then(function(o){console.log("dfjkl  "),t.path("/"),e.error=""}).catch(function(o){console.error(o),e.error=o})}}angular.module("myApp").controller("LoginController",o),o.$inject=["$location","authService"]})(),angular.module("myApp").config(["$routeProvider","$httpProvider",function(o,t){o.when("/",{templateUrl:"app/view/home.html",controller:"HomeController",controllerAs:"vm"}).when("/login",{templateUrl:"app/view/login.html",controller:"LoginController",controllerAs:"vm"}).when("/addbook",{templateUrl:"app/view/bookAdd.html",controller:"BookAddController",controllerAs:"vm"}).otherwise({redirectTo:"/"}),t.interceptors.push("authInterceptor")}]),angular.module("myApp").service("authService",["$http","$window","$rootScope",function(t,e,o){this.login=function(o){return t.post("".concat("http://localhost:5007/api/","Login/LoginUser"),o).then(function(o){return o.data&&(e.localStorage.setItem("accessToken",o.data.accessToken),e.localStorage.setItem("refreshToken",o.data.refreshToken)),o.data}).catch(function(o){throw o.data.message})},this.getToken=function(){return e.localStorage.getItem("accessToken")},this.isAuthenticated=function(){return!!this.getToken()},this.logout=function(){e.localStorage.removeItem("accessToken"),e.localStorage.removeItem("refreshToken")}}]),(()=>{function o(e){var n={books:[]},r=(this.state=n,"http://localhost:5007/api/");this.getBooks=function(){return e.get("".concat(r,"Books/GellAllBooks")).then(function(o){return n.books=o.data,n.books}).catch(function(o){throw console.error("Error fetching books:",o),o})},this.deleteBook=function(t){return e.delete("".concat(r,"Books/DeleteBook/").concat(t)).then(function(){return n.books=n.books.filter(function(o){return o.bookId!==t}),n.books}).catch(function(o){throw console.error("Error deleting book:",o),o})},this.addBook=function(o){return e.post("".concat(r,"Books/AddBook"),o).then(function(){return n.books.push(o),n.books}).catch(function(o){throw console.error("Error at Adding",o),o})}}angular.module("myApp").service("bookService",o),o.$inject=["$http"]})(),(()=>{function o(o,t){this.isLoggedIn=function(){return o.isAuthenticated()},this.logout=function(){o.logout(),t.path("/login")}}angular.module("myApp").controller("NavbarController",o),o.$inject=["authService","$location"]})();